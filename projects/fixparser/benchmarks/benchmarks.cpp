#include "fix_message_parser.h"

static void ParseSnapshotBenchmark(benchmark::State& state) {
  const auto w =
    "8=FIX.4.4\u0001"
    "9=2568\u0001"
    "35=W\u0001"
    "49=FADS_MD\u0001"
    "56=WEBUI_MD_IFT_FIX\u0001"
    "34=2\u000152=20230416-08:45:57.109\u0001"
    "262=d1b0cc200ebb7e3e#a29f1cbc-e1e3-4519-b114-f0854764c23c\u0001"
    "55=USD/RUB\u0001"
    "167=FXSPOT\u0001"
    "6215=TOM\u0001"
    "64=20230417\u0001"
    "779=20230416-08:45:57.102\u0001"
    "1151=RMKV\u0001"
    "268=22\u0001"
    "269=0\u0001"
    "270=80.3750\u0001"
    "271=100000\u0001"
    "276=A\u0001"
    "299=d1b0cc200ebb7e3e#a29f1cbc-e1e3-4519-b114-f0854764c23cB100000_p267\u0001"
    "269=0\u0001"
    "270=80.3750\u0001"
    "271=250000\u0001"
    "276=A\u0001"
    "299=d1b0cc200ebb7e3e#a29f1cbc-e1e3-4519-b114-f0854764c23cB250000_p267\u0001"
    "269=0\u0001"
    "270=80.3750\u0001"
    "271=500000\u0001"
    "276=A\u0001"
    "299=d1b0cc200ebb7e3e#a29f1cbc-e1e3-4519-b114-f0854764c23cB500000_p267\u0001"
    "269=0\u0001"
    "270=80.3750\u0001"
    "271=1000000\u0001"
    "276=A\u0001"
    "299=d1b0cc200ebb7e3e#a29f1cbc-e1e3-4519-b114-f0854764c23cB1000000_p267\u0001"
    "269=0\u0001"
    "270=80.3000\u0001"
    "271=2000000\u0001"
    "276=A\u0001"
    "299=d1b0cc200ebb7e3e#a29f1cbc-e1e3-4519-b114-f0854764c23cB2000000_p267\u0001"
    "269=0\u0001"
    "270=80.1750\u0001"
    "271=3000000\u0001"
    "276=A\u0001"
    "299=d1b0cc200ebb7e3e#a29f1cbc-e1e3-4519-b114-f0854764c23cB3000000_p267\u0001"
    "269=0\u0001"
    "270=80.0500\u0001"
    "271=5000000\u0001"
    "276=A\u0001"
    "299=d1b0cc200ebb7e3e#a29f1cbc-e1e3-4519-b114-f0854764c23cB5000000_p267\u0001"
    "269=0\u0001"
    "270=79.8500\u0001"
    "271=10000000\u0001"
    "276=A\u0001"
    "299=d1b0cc200ebb7e3e#a29f1cbc-e1e3-4519-b114-f0854764c23cB10000000_p267\u0001"
    "269=0\u0001"
    "270=79.4500\u0001"
    "271=20000000\u0001"
    "276=A\u0001"
    "299=d1b0cc200ebb7e3e#a29f1cbc-e1e3-4519-b114-f0854764c23cB20000000_p267\u0001"
    "269=0\u0001"
    "270=79.0500\u0001"
    "271=30000000\u0001"
    "276=A\u0001"
    "299=d1b0cc200ebb7e3e#a29f1cbc-e1e3-4519-b114-f0854764c23cB30000000_p267\u0001"
    "269=0\u0001"
    "270=77.6500\u0001"
    "271=50000000\u0001"
    "276=A\u0001"
    "299=d1b0cc200ebb7e3e#a29f1cbc-e1e3-4519-b114-f0854764c23cB50000000_p267\u0001"
    "269=1\u0001"
    "270=81.0700\u0001"
    "271=100000\u0001"
    "276=A\u0001"
    "299=d1b0cc200ebb7e3e#a29f1cbc-e1e3-4519-b114-f0854764c23cA100000_p267\u0001"
    "269=1\u0001"
    "270=81.0700\u0001"
    "271=250000\u0001"
    "276=A\u0001"
    "299=d1b0cc200ebb7e3e#a29f1cbc-e1e3-4519-b114-f0854764c23cA250000_p267\u0001"
    "269=1\u0001"
    "270=81.0700\u0001"
    "271=500000\u0001"
    "276=A\u0001"
    "299=d1b0cc200ebb7e3e#a29f1cbc-e1e3-4519-b114-f0854764c23cA500000_p267\u0001"
    "269=1\u0001"
    "270=81.0700\u0001"
    "271=1000000\u0001"
    "276=A\u0001"
    "299=d1b0cc200ebb7e3e#a29f1cbc-e1e3-4519-b114-f0854764c23cA1000000_p267\u0001"
    "269=1\u0001"
    "270=81.1450\u0001"
    "271=2000000\u0001"
    "276=A\u0001"
    "299=d1b0cc200ebb7e3e#a29f1cbc-e1e3-4519-b114-f0854764c23cA2000000_p267\u0001"
    "269=1\u0001"
    "270=81.2700\u0001"
    "271=3000000\u0001"
    "276=A\u0001"
    "299=d1b0cc200ebb7e3e#a29f1cbc-e1e3-4519-b114-f0854764c23cA3000000_p267\u0001"
    "269=1\u0001"
    "270=81.3950\u0001"
    "271=5000000\u0001"
    "276=A\u0001"
    "299=d1b0cc200ebb7e3e#a29f1cbc-e1e3-4519-b114-f0854764c23cA5000000_p267\u0001"
    "269=1\u0001"
    "270=81.5950\u0001"
    "271=10000000\u0001"
    "276=A\u0001"
    "299=d1b0cc200ebb7e3e#a29f1cbc-e1e3-4519-b114-f0854764c23cA10000000_p267\u0001"
    "269=1\u0001"
    "270=81.9950\u0001"
    "271=20000000\u0001"
    "276=A\u0001"
    "299=d1b0cc200ebb7e3e#a29f1cbc-e1e3-4519-b114-f0854764c23cA20000000_p267\u0001"
    "269=1\u0001"
    "270=82.3950\u0001"
    "271=30000000\u0001"
    "276=A\u0001"
    "299=d1b0cc200ebb7e3e#a29f1cbc-e1e3-4519-b114-f0854764c23cA30000000_p267\u0001"
    "269=1\u0001"
    "270=83.7950\u0001"
    "271=50000000\u0001"
    "276=A\u0001"
    "299=d1b0cc200ebb7e3e#a29f1cbc-e1e3-4519-b114-f0854764c23cA50000000_p267\u0001"
    "10=218\u0001"s;

  for (auto _ : state) {
    Expected<FixMessage> message;
    benchmark::DoNotOptimize(message = FixMessageParser::Parse(w));
  }
}

static void ParseMarketDataRequestBenchmark(benchmark::State& state) {
  const auto v =
    "8=FIX.4.4\u0001"
    "9=219\u0001"
    "35=V\u0001"
    "34=2\u0001"
    "49=WEBUI_MD_IFT_FIX\u0001"
    "52=20230416-08:45:56.903\u0001"
    "56=FADS_MD\u0001"
    "262=d1b0cc200ebb7e3e#a29f1cbc-e1e3-4519-b114-f0854764c23c\u0001"
    "263=1\u0001"
    "264=0\u0001"
    "265=0\u0001"
    "146=1\u0001"
    "55=USD/RUB\u0001"
    "167=FXSPOT\u0001"
    "64=20230417\u0001"
    "1151=RMKV\u0001"
    "6215=TOM\u0001"
    "267=2\u0001"
    "269=0\u0001"
    "269=1\u0001"
    "10=141\u0001"s;

  for (auto _ : state) {
    Expected<FixMessage> message;
    benchmark::DoNotOptimize(message = FixMessageParser::Parse(v));
  }
}

static void ParseLogonBenchmark(benchmark::State& state) {
  const auto a =
    "8=FIX.4.4\u0001"
    "9=101\u0001"
    "35=A\u0001"
    "34=1\u0001"
    "49=WEBUI_MD_IFT_FIX\u0001"
    "52=20230416-00:00:01.200\u0001"
    "56=FADS_MD\u0001"
    "58=forced_logout\u0001"
    "98=0\u0001"
    "108=30\u0001"
    "141=Y\u0001"
    "10=083\u0001"s;

  for (auto _ : state) {
    Expected<FixMessage> message;
    benchmark::DoNotOptimize(message = FixMessageParser::Parse(a));
  }
}

BENCHMARK(ParseLogonBenchmark);
BENCHMARK(ParseMarketDataRequestBenchmark);
BENCHMARK(ParseSnapshotBenchmark);
BENCHMARK_MAIN();